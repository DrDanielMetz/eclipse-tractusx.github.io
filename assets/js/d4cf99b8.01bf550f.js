"use strict";(self.webpackChunkeclipse_tractusx_github_io=self.webpackChunkeclipse_tractusx_github_io||[]).push([[9186],{51088:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var a=n(87462),r=(n(67294),n(3905));const o={title:"TRG 4.03 - Non-root container"},i=void 0,l={unversionedId:"release/trg-4/trg-4-3",id:"release/trg-4/trg-4-3",title:"TRG 4.03 - Non-root container",description:"| Author               | Status | Created      | Post-History                     |",source:"@site/docs/release/trg-4/trg-4-3.md",sourceDirName:"release/trg-4",slug:"/release/trg-4/trg-4-3",permalink:"/docs/release/trg-4/trg-4-3",draft:!1,editUrl:"https://github.com/eclipse-tractusx/eclipse-tractusx.github.io/tree/main/docs/release/trg-4/trg-4-3.md",tags:[],version:"current",frontMatter:{title:"TRG 4.03 - Non-root container"},sidebar:"developer",previous:{title:"TRG 4.02 - Base images",permalink:"/docs/release/trg-4/trg-4-2"},next:{title:"TRG 4.04 - Image signing",permalink:"/docs/release/trg-4/trg-4-4"}},s={},u=[{value:"Description",id:"description",level:2},{value:"Why",id:"why",level:2},{value:"Implementation",id:"implementation",level:2}],d={toc:u};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Author"),(0,r.kt)("th",{parentName:"tr",align:null},"Status"),(0,r.kt)("th",{parentName:"tr",align:null},"Created"),(0,r.kt)("th",{parentName:"tr",align:null},"Post-History"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Catena-X System Team"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"14-Sept-2022"),(0,r.kt)("td",{parentName:"tr",align:null},"Draft")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Catena-X System Team"),(0,r.kt)("td",{parentName:"tr",align:null},"Active"),(0,r.kt)("td",{parentName:"tr",align:null},"29-Dec-2022"),(0,r.kt)("td",{parentName:"tr",align:null},"Initial Release")))),(0,r.kt)("h2",{id:"description"},"Description"),(0,r.kt)("p",null,"For security reasons a container is not allowed to run with root privileges."),(0,r.kt)("h2",{id:"why"},"Why"),(0,r.kt)("p",null,"To make sure that a compromised container doesn't have root permissions on the underlying infrastructure and has limited ways of manipulating the compromised container itself. A non-root user might be able to break out of the application code but then is still bound by the user permimssions."),(0,r.kt)("h2",{id:"implementation"},"Implementation"),(0,r.kt)("p",null,"The container's ",(0,r.kt)("strong",{parentName:"p"},"Dockerfile")," and the ",(0,r.kt)("strong",{parentName:"p"},"Pod resouce file (yaml)")," has to be modified to be able to run as a non-root user."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Modify the image's Dockerfile with a ",(0,r.kt)("inlineCode",{parentName:"li"},"RUN")," command that adds a non-root user and a ",(0,r.kt)("inlineCode",{parentName:"li"},"USER")," command that specifies which user runs the container on startup. The example below can be modified for specific needs/requirements.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Dockerfile"},"#Pull the base image as Ubuntu\nFROM ubuntu:latest\n\n#Add a user with userid 8877 and name nonroot\nRUN useradd \u2212u 8877 nonroot\n\n#Run Container as nonroot\nUSER nonroot\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Modify the ",(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-container"},"Pod's or Deployment's configuration")," by adding ",(0,r.kt)("inlineCode",{parentName:"li"},"runAsUser")," field for both the pod's and container's securityContext section. Also set the ",(0,r.kt)("inlineCode",{parentName:"li"},"allowPrivilegeEscalation")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," on the container's securityContext. See the example below:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: example-pod\nspec:\n  securityContext:\n    runAsUser: 1000 # SPECIFY USER ID HERE\n  containers:\n  - name: example-container\n    image: gcr.io/google-samples/node-hello:1.0\n    securityContext:\n      runAsUser: 1000 # SPECIFY USER ID HERE\n      allowPrivilegeEscalation: false # SET THIS TO FALSE\n")))}m.isMDXComponent=!0}}]);